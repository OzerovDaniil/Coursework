<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—É—à—ñ-–ú–∞–π—Å—Ç–µ—Ä - –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <div id="header-placeholder"></div>

    <main class="orders-page">
        <section class="orders-hero">
            <h1>–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
            <p class="subtitle">–ü–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ —Ç–∞ –∫–µ—Ä—É–π—Ç–µ —Å–≤–æ—ó–º–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏</p>
        </section>

        <section class="orders-content">
            <div class="orders-filters">
                <button class="filter-btn active" data-status="all">–í—Å—ñ</button>
                <button class="filter-btn" data-status="pending">–í –æ–±—Ä–æ–±—Ü—ñ</button>
                <button class="filter-btn" data-status="preparing">–ì–æ—Ç—É—é—Ç—å—Å—è</button>
                <button class="filter-btn" data-status="ready">–ì–æ—Ç–æ–≤—ñ</button>
                <button class="filter-btn" data-status="delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω—ñ</button>
                <button class="filter-btn" data-status="cancelled">–°–∫–∞—Å–æ–≤–∞–Ω—ñ</button>
            </div>

            <div class="orders-grid" id="ordersGrid">
                <!-- –¢—É—Ç –±—É–¥—É—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
                <p>üìû +380 44 123 4567</p>
                <p>‚úâÔ∏è info@sushi-master.ua</p>
                <p>üìç –≤—É–ª. –°—É—à–∏—Å—Ç–∞, 1, –º. –ö–∏—ó–≤</p>
            </div>
            <div class="footer-section">
                <h3>–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏</h3>
                <p>–ü–Ω-–ü—Ç: 10:00 - 22:00</p>
                <p>–°–±-–ù–¥: 11:00 - 23:00</p>
            </div>
            <div class="footer-section">
                <h3>–°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –Ω–∞–º–∏</h3>
                <div class="social-links">
                    <a href="#" class="social-link">Facebook</a>
                    <a href="#" class="social-link">Instagram</a>
                    <a href="#" class="social-link">Telegram</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 –°—É—à—ñ-–ú–∞–π—Å—Ç–µ—Ä. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</p>
        </div>
    </footer>

    <script type="module">
        fetch('/front/components/header.html')
            .then(r => r.text())
            .then(html => {
                document.getElementById('header-placeholder').innerHTML = html;
                import('/front/js/main.js');
            });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å
        async function displayOrders() {
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    window.location.href = '/index.html';
                    return;
                }

                const orders = await api.getOrders();
                const ordersGrid = document.getElementById('ordersGrid');
                ordersGrid.innerHTML = '';

                if (orders.length === 0) {
                    ordersGrid.innerHTML = `
                        <div class="no-orders">
                            <p>–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
                            <a href="/pages/menu.html" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –º–µ–Ω—é</a>
                        </div>
                    `;
                    return;
                }

                orders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = `order-card ${order.status}`;
                    orderElement.innerHTML = `
                        <div class="order-header">
                            <h3>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${order.id}</h3>
                            <span class="order-date">${new Date(order.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="order-items">
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <span class="item-name">${item.name}</span>
                                    <span class="item-quantity">x${item.quantity}</span>
                                    <span class="item-price">${item.price} ‚Ç¥</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="order-footer">
                            <div class="order-total">
                                <span>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞:</span>
                                <span class="total-price">${order.totalAmount} ‚Ç¥</span>
                            </div>
                            <div class="order-status">
                                <span class="status-badge ${order.status}">${getStatusText(order.status)}</span>
                            </div>
                            ${order.status === 'pending' ? `
                                <button class="btn btn-secondary cancel-order" data-id="${order.id}">
                                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                                </button>
                            ` : ''}
                        </div>
                    `;
                    ordersGrid.appendChild(orderElement);
                });

                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
                const filterButtons = document.querySelectorAll('.filter-btn');
                filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        const status = button.dataset.status;
                        const orders = document.querySelectorAll('.order-card');

                        orders.forEach(order => {
                            if (status === 'all' || order.classList.contains(status)) {
                                order.style.display = 'block';
                            } else {
                                order.style.display = 'none';
                            }
                        });
                    });
                });

                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
                const cancelButtons = document.querySelectorAll('.cancel-order');
                cancelButtons.forEach(button => {
                    button.addEventListener('click', async () => {
                        const orderId = button.dataset.id;
                        if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?')) {
                            try {
                                await api.updateOrderStatus(orderId, 'cancelled');
                                displayOrders(); // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å
                            } catch (error) {
                                console.error('–ü–æ–º–∏–ª–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:', error);
                                alert('–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è');
                            }
                        }
                    });
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å:', error);
                alert('–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω—å');
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É —Å—Ç–∞—Ç—É—Å—É
        function getStatusText(status) {
            const statusMap = {
                'pending': '–í –æ–±—Ä–æ–±—Ü—ñ',
                'preparing': '–ì–æ—Ç—É—é—Ç—å—Å—è',
                'ready': '–ì–æ—Ç–æ–≤—ñ',
                'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω—ñ',
                'cancelled': '–°–∫–∞—Å–æ–≤–∞–Ω—ñ'
            };
            return statusMap[status] || status;
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', displayOrders);
    </script>
</body>

</html>